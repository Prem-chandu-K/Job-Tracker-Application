<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Job Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2> My Job Applications</h2>
        <a href="/jobs/new" class="btn btn-primary">âž• Add Job</a>
    </div>
    
    <!-- ðŸ“Š DASHBOARD -->
<div class="row mb-4 text-center">

    <!-- Total Applied -->
    <div class="col-md-3">
        <div class="card shadow-sm border-primary">
            <div class="card-body">
                <h6 class="text-muted">Total Jobs</h6>
                <h3 class="text-primary"
                    th:text="${#lists.size(jobs)}">0</h3>
            </div>
        </div>
    </div>

    <!-- In Progress -->
    <div class="col-md-3">
        <div class="card shadow-sm border-warning">
            <div class="card-body">
                <h6 class="text-muted">In Progress</h6>
                <h3 class="text-warning"
                    th:text="${#lists.size(jobs.?[status.name() == 'APPLIED' or status.name() == 'INTERVIEW'])}">
                    0
                </h3>
            </div>
        </div>
    </div>

    <!-- Offers -->
    <div class="col-md-3">
        <div class="card shadow-sm border-success">
            <div class="card-body">
                <h6 class="text-muted">Offers</h6>
                <h3 class="text-success"
                    th:text="${#lists.size(jobs.?[status.name() == 'OFFER'])}">
                    0
                </h3>
            </div>
        </div>
    </div>

    <!-- Rejected -->
    <div class="col-md-3">
        <div class="card shadow-sm border-danger">
            <div class="card-body">
                <h6 class="text-muted">Rejected</h6>
                <h3 class="text-danger"
                    th:text="${#lists.size(jobs.?[status.name() == 'REJECTED'])}">
                    0
                </h3>
            </div>
        </div>
    </div>

</div>
    

    <!-- ðŸ” FILTER FORM -->
    <form method="get" th:action="@{/jobs}" class="row g-3 mb-4">

        <!-- Company Filter -->
        <div class="col-md-5">
            <input type="text"
                   name="company"
                   class="form-control"
                   placeholder="Filter by company name"
                   th:value="${company}">
        </div>

        <!-- Status Filter -->
        <div class="col-md-4">
            <select name="status" class="form-select">
                <option value="">-- Filter by status --</option>
                <option th:each="st : ${statuses}"
                        th:value="${st}"
                        th:text="${st}"
                        th:selected="${st == selectedStatus}">
                </option>
            </select>
        </div>

        <!-- Buttons -->
        <div class="col-md-3 d-flex gap-2">
            <button type="submit" class="btn btn-success w-100">Apply</button>
            <a href="/jobs" class="btn btn-secondary w-100">Reset</a>
        </div>

    </form>

    <!-- ðŸ“‹ TABLE -->
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
        <tr>
            <th>Company</th>
            <th>Position</th>
            <th>Status</th>
            <th>Applied</th>
            <th>Interview</th>
            <th>Action</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="job : ${jobs}">
            <td th:text="${job.companyName}"></td>
            <td th:text="${job.position}"></td>

            <!-- Status Badge -->
            <td>
                <span th:switch="${job.status.name()}">
                    <span th:case="'APPLIED'" class="badge bg-secondary">APPLIED</span>
                    <span th:case="'INTERVIEW'" class="badge bg-warning">INTERVIEW</span>
                    <span th:case="'OFFER'" class="badge bg-success">OFFER</span>
                    <span th:case="*" class="badge bg-danger"
                          th:text="${job.status}"></span>
                </span>
            </td>

            <td th:text="${job.appliedDate}"></td>
            <td th:text="${job.interviewDate} ?: '-'"></td>

            <td>
                <a th:href="@{/jobs/edit/{id}(id=${job.id})}"
                   class="btn btn-sm btn-warning me-1">Edit</a>
                <a th:href="@{/jobs/delete/{id}(id=${job.id})}"
                   class="btn btn-sm btn-danger">Delete</a>
            </td>
        </tr>
        </tbody>
    </table>

</div>

</body>
</html>
